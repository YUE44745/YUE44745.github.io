<!DOCTYPE html><html><head>
      <title>Log</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\YUE44745\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.11\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      pre{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;padding:1em;margin:.5em 0;overflow:auto;line-height:1.5;tab-size:4;hyphens:none;color:#2b3f6a;background-color:#eee9dd!important;border:#ddd3bb;border-radius:3px}pre[class*=language-]{padding:1em}code[class*=language-] .token.cdata,code[class*=language-] .token.comment,code[class*=language-] .token.doctype,code[class*=language-] .token.prolog,pre[class*=language-] .token.cdata,pre[class*=language-] .token.comment,pre[class*=language-] .token.doctype,pre[class*=language-] .token.prolog{color:#9ca3b0;font-style:italic}code[class*=language-] .token.punctuation,pre[class*=language-] .token.punctuation{color:#9ca3b0}code[class*=language-] .namespace,pre[class*=language-] .namespace{opacity:.7}code[class*=language-] .token.constant,pre[class*=language-] .token.constant{color:#c16161}code[class*=language-] .token.boolean,code[class*=language-] .token.function-name,code[class*=language-] .token.number,pre[class*=language-] .token.boolean,pre[class*=language-] .token.function-name,pre[class*=language-] .token.number{color:#c16161}code[class*=language-] .token.tag,pre[class*=language-] .token.tag{color:#ac4343}code[class*=language-] .token.symbol,pre[class*=language-] .token.symbol{color:#8f932b}code[class*=language-] .token.selector,pre[class*=language-] .token.selector{color:#d08e25}code[class*=language-] .token.attr-name,pre[class*=language-] .token.attr-name{color:#d08e25}code[class*=language-] .token.string,pre[class*=language-] .token.string{background-color:rgba(255,204,0,.03);color:rgba(106,68,28,.77)}code[class*=language-] .token.char,pre[class*=language-] .token.char{color:#8f932b}code[class*=language-] .token.url,pre[class*=language-] .token.url{color:#d08e25}code[class*=language-] .token.atrule,code[class*=language-] .token.attr-value,code[class*=language-] .token.keyword,pre[class*=language-] .token.atrule,pre[class*=language-] .token.attr-value,pre[class*=language-] .token.keyword{color:#8f932b}code[class*=language-] .token.function,pre[class*=language-] .token.function{color:#d08e25}code[class*=language-] .token.class-name,pre[class*=language-] .token.class-name{color:#2b3f6a}code[class*=language-] .token.variable,pre[class*=language-] .token.variable{color:#5e78e1}code[class*=language-] .token.important,code[class*=language-] .token.regex,pre[class*=language-] .token.important,pre[class*=language-] .token.regex{color:#379566}code[class*=language-] .token.bold,code[class*=language-] .token.important,pre[class*=language-] .token.bold,pre[class*=language-] .token.important{font-weight:700}code[class*=language-] .token.italic,pre[class*=language-] .token.italic{font-style:italic}code[class*=language-] .token.entity,pre[class*=language-] .token.entity{cursor:help}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}body{font-size:16px;background-color:#f3f2ee;font-family:'PT Serif','Times New Roman',Times;color:#1f0909;line-height:1.5em}body ol,body ul{list-style:none}body blockquote,body q{quotes:none}body blockquote:after,body blockquote:before,body q:after,body q:before{content:'';content:none}body table{border-collapse:collapse;border-spacing:0}body h1,body h2,body h3,body h4,body h5,body h6{font-weight:700}body h1{font-size:1.875em;line-height:1.6em;margin-top:2em}body h2,body h3{font-size:1.3125em;line-height:1.15;margin-top:2.285714em;margin-bottom:1.15em}body h3{font-weight:400}body h4{font-size:1.125em;margin-top:2.67em}body h5,body h6{font-size:1em}body h1{border-bottom:1px solid;margin-bottom:1.875em;padding-bottom:.8125em}body a{text-decoration:none;color:#065588}body a:active,body a:hover{text-decoration:underline}body .md-fences,body blockquote,body p{margin-bottom:1.5em}body h1,body h2,body h3,body h4,body h5,body h6{margin-bottom:1.5em}body blockquote{font-style:italic;border-left:5px solid;margin-left:2em;padding-left:1em}body ol,body ul{margin:0 0 1.5em 1.5em}body ol li{list-style-type:decimal;list-style-position:outside}body ul li{list-style-type:disc;list-style-position:outside}body li>p{margin-top:0;margin-bottom:0}body .md-after,body .md-before,body .md-meta{color:#999}body table{margin-bottom:1.5em;font-size:1em}body tfoot th,body thead th{padding:.25em .25em .25em .4em;text-transform:uppercase}body th{text-align:left}body td{vertical-align:top;padding:.25em .25em .25em .4em}body .md-fences,body code{color:inherit;background-color:#dadada;padding-left:1ch;padding-right:1ch}body pre code{background-color:inherit}body .md-fences{margin-left:2em;margin-bottom:3em}body .md-fences .CodeMirror.CodeMirror-wrap{top:-.8em}body code,body pre,body tt{font-size:.875em;line-height:1.714285em}body h1{line-height:1.3em;font-weight:400;margin-bottom:.5em}body p+ol,body p+ul{margin-top:-1em}body h3+ol,body h3+ul,body h4+ol,body h4+ul,body h5+ol,body h5+ul,body h6+ol,body h6+ul{margin-top:.5em}body li>ol,body li>ul{margin-top:inherit}body h2,body h3{margin-bottom:.75em}body hr{border-top:none;border-right:none;border-bottom:1px solid;border-left:none}body h1{border-color:#c5c5c5}body blockquote{border-color:#bababa;color:#656565;background-color:#e6e4dc}body thead.md-table-edit{background-color:transparent}body thead{background-color:#dadada}body tr:nth-child(even){background:#e8e7e7}body hr{border-color:#c5c5c5}body .task-list{padding-left:1rem}body .task-list-item{list-style-type:none;margin-left:-1.8em}body .task-list-item .task-list-item-checkbox{margin-right:.8em}body .task-list-item input:before{content:'\221A';display:inline-block;width:1.25rem;height:1.5rem;vertical-align:middle;text-align:center;color:#ddd;background-color:#f3f2ee}body .task-list-item input:checked:before,body .task-list-item input[checked]:before{color:inherit}body img{max-width:100%}body kbd{color:#1f0909}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="log-for-design">Log for design </h1>
<p><strong>Introduce</strong>: This is a log for the anlog IC design group 17. Everthing in the process of this design can be record in this log.<br>
<strong>Author</strong>: UpstreamWind</p>
<h2 id="log">Log </h2>
<h3 id="122">12.2 </h3>
<p>Am: Just learn how to use the cadence, and the demonstration is maked.<br>
Pm and night: design the <em>5 tube OTA</em>, how to design a <em>two stage OPA</em>, and learn the <em>technique evaluation</em>.</p>
<ul>
<li>lerning the cadence:</li>
<li>5 tube OTA:
<ol>
<li>设计流程，我们在设计5管运放的时候，是按照指导书所写的那样进行设计流程的思考。
<ol>
<li>满足GBW足够，得到应有的跨导最小值</li>
<li>通过跨导最小值得到输入管尺寸
<ol>
<li>通过Vov，gm，得到电流。Vov中假设共模输入为1.6（电源的一半），过冲电压为0.4，即认为tail的栅极输入最低为1V。</li>
<li>得到电流，Vov，K，得到宽长比</li>
</ol>
</li>
<li>通过跨到最小值计算尾电流源应该提供的电流，计算的tail的尺寸（默认Vov为0.3v）</li>
<li>同样通过电流计算得到负载管的尺寸（计算Vov）</li>
<li>tail current用电流镜来提供，电流镜尺寸按比例要求。</li>
<li>满足GBW之后，计算如何满足增益，如果不满足，分析调整尺寸。</li>
<li>最后检查直流工作点，交流特性仿真验证。</li>
<li>记录设计指标、计算指标、仿真结果以及迭代过程。</li>
</ol>
</li>
<li>指标迭代过程
<ol>
<li>第1次设计(按照ppt指导的，略)
<table>
<thead>
<tr>
<th>指标</th>
<th>设计指标</th>
<th>计算指标</th>
<th>仿真结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>VDD</td>
<td>3.3</td>
<td>3.3</td>
<td>3.3</td>
</tr>
<tr>
<td>GAIN</td>
<td>&gt;50db</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GBW</td>
<td>&gt;100Mhz</td>
<td></td>
<td></td>
</tr>
<tr>
<td>CL</td>
<td>1pf</td>
<td>1pf</td>
<td>1pf</td>
</tr>
</tbody>
</table>
</li>
<li>第2次设计（最终满足结果）
<table>
<thead>
<tr>
<th>指标</th>
<th>设计指标</th>
<th>计算指标</th>
<th>仿真结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>VDD</td>
<td>3.3</td>
<td>3.3</td>
<td>3.3</td>
</tr>
<tr>
<td>GAIN</td>
<td>&gt;50db</td>
<td>56.279840db</td>
<td>54.5032db</td>
</tr>
<tr>
<td>GBW</td>
<td>&gt;100MHz</td>
<td>143.63MHz</td>
<td>113.37MHz</td>
</tr>
<tr>
<td>CL</td>
<td>1pf</td>
<td>1pf</td>
<td>1pf</td>
</tr>
<tr>
<td>以下是我们的一些计算指标的计算过程过程：</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li>首先通过电流源，得到尾电流和输入管电流，然后宽长比，kn得到gm=0.902mS。</li>
<li>利用gm、2pi*CL得到GBW</li>
<li>测得特定宽长比：K是已知值，lamda_n=11.5m/v,lamda_p=4.32m/v,又得知电路，起初输出阻抗，得知gm,求得Gain。</li>
</ol>
</li>
</ol>
</li>
<li>kn=125uA/V kp=25uA/V</li>
</ol>
</li>
<li>technique evaluation<br>
<strong>////////////////////////////////////////////////////////////////////////</strong><br>
<strong>////////////////////////////////////////////////////////////////////////</strong><br>
<strong>//// 注意使用 ❤️ 的地方需要记录数据和迭代过程 /////////</strong><br>
<strong>////////////////////////////////////////////////////////////////////////</strong><br>
<strong>////////////////////////////////////////////////////////////////////////</strong></li>
</ul>
<h3 id="124">12.4 </h3>
<p>AM： 工艺评估<br>
PM： 五管数据记录+二级运放1设计<br>
Night: 二级运放2设计</p>
<ol>
<li>设计二级运放1(该结构暂时没有调出来)
<ol>
<li>结构初定：使用第一级是折叠cascode，第二级共源放大，使用自偏置。<br>
<strong>暂时搁置，把运放2设计结束完再考虑做这个</strong></li>
</ol>
</li>
<li>设计二级运放2（使用最简单的结构）
<ol>
<li>即结构为第一级为五管运放，第二级别为一个简单地CS。</li>
<li>确定结构之后，首先使用的第一级就是前面已经构建好的拥有着54db增益、143.63Mhz的带宽。通过静态工作点的测量得到输出电压为2V，从而分析要使得达到总共65db的增益需要第二级提供11db的增益。</li>
<li>所以搭建第二级运放，第二级运放使用的简单的共源结构，直流工作点为输入电压为2v，如果使用N管，那么过冲电压为1.3V,要工作在饱和区需要，工作点输出电压要在1.3V以上才可以，那么电压摆幅为1.3~ 3.3V，如果使用P管作为输入管，那么过冲电压为0.6V，输出摆幅可以达到0~2.7V，显然使用P管作为输入管更加的合适，但是造成的另一个问题便是使得电压增益减小，因为同样的面积下P管的放大能力更小，这是需要权衡考虑的。</li>
<li>但是我们还是使用了P管作为输入管，因为作为运放的最后一级，它的输出摆幅相对与增益来说是更加重要的，因为增益的任务可以放给第一级来完成。通过前面分析得知第二级满足11db（3.548倍）的增益就可以了，通过实际调整放很大P输入管的W/L（这个时候差不多是200u/2u）就可以达到6倍（15db）的增益效果，仿真结果如此。 ❤️ 。</li>
<li>但是考虑到过大的P管（因为面积占版图的十分之一，其实也不算大），可能会造成寄生电容，担心后仿真会影响电路性能。（但是添加Cc电容，如果电容值较大，那么其实就算P管的栅极电容大一点也没有关系，独一输出端来说，Cdb电容的值较负载电容而言来说可能也很小，所以是影响是不大的，是可以放心的）</li>
<li>待解决的问题：
<ul>
<li>使用由于第二级放大部分使用的是电阻作为负载，显然这是不合理的，使用电阻作为负载，其对电源波动的抵抗很弱，并且由于需要较大的输出电压，电阻也比较大，会带来较大的热噪声。所以决定使用电流源负载。电流源做负载难以计算，所以仿真得到合适的值。最后使得增益达标。</li>
<li>仔细学习如何进行miller补偿，更方便后续进行补偿，并且这也是模拟集成电路考试的重点。最后使得带宽和相位phase margin达标。</li>
<li>由于摆幅范围为0~ 2.7，并且需要&gt;1V的摆幅，所以静态输出电压应该为1.35V，最小输出摆幅至少为0.85~1.85V。</li>
<li>最后测量功耗/PSRR/CMRR是否符合要求，再做调整。</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>12.5<br>
phase margin为60度对应的频率应该为0.62wp2（下图有有解释）对应的增益为1时候的情况。</p>
<ul>
<li>所以后续对频率补偿只需要让从wp1开始降低，降低到0db的时候的频率任然还小于0.62wp2。</li>
<li>并且还要满足10wp1&lt;(1/10)wp2</li>
<li>还要满足GX&lt;(1/10)wp3</li>
</ul>
<p>暂时还没有考虑零点带来的影响，值得注意的一点是，由于在之前的分析中忽略了镜像极点，所以一共有三个极点，分别是输出极点，两级运放中间的极点，镜像极点，应当仔细分析这三个极点的的大小顺序。</p>
<ul>
<li>我想到一个分析的方法，分别在三个极点上面挂载接地的大电容进行仿真，主极点便很好地找出来了，再对镜像极点进行测试，当挂较大电容，如果出现phase margin情况恶化严重的话，那么是第二极点，如果影响很小，那么是第三极点。<br>
那么如何计算补偿之后的极点呢<br>
<strong>注意：这其中搞错了主极点和次极点之间的位置</strong><br>
<img src="png1.jpg" alt="phase margin and calculate the pole after compensation"><br>
前面12.4的2.6中提到过输出摆幅的问题，当时并没有考虑负载管是一个电流源偏置，所以假设负载管的过冲电压为0.2V的余度，这样摆幅范围变为了0.2~ 2.7V，那么静态输出电压应该为1.45V，最小输出摆幅至少为0.95~1.95V。</li>
</ul>
<p>12.6<br>
gm/ID的方法来进行设计中的方法评估来计算电路来进行电路设计（这个认为是工艺评估中的一部分）,从下面这个视屏中学习得到。（【The gmid methodology, a design guideline for two stage miller OP】 <a href="https://www.bilibili.com/video/BV1PZ4y1g7cZ/?share_source=copy_web&amp;vd_source=aa4641ffa1428b9b417d1c648edda95b%EF%BC%89">https://www.bilibili.com/video/BV1PZ4y1g7cZ/?share_source=copy_web&amp;vd_source=aa4641ffa1428b9b417d1c648edda95b）</a><br>
gm/Id=2/Vov,近似相等，所以选取一个晶体管的gm/Id,就是选择偏置电压。</p>
<ol>
<li>gm与速度和噪声相关：
<ol>
<li>一个单独的管子，频宽与gm的关系:fT=gm/2*pi*Cgs</li>
<li>和噪声可以正比也可以反比</li>
</ol>
</li>
<li>ID与功耗有关与增益有关</li>
<li>权衡两者：有限电流--&gt;快速、低噪</li>
<li>通过gm/ID选W/L
<ol>
<li>W取一个定值</li>
<li>取L--&gt;ro--&gt;gain
<ul>
<li>sweep graph: gain gm/Id，</li>
</ul>
</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th>cellview</th>
<th>什么</th>
</tr>
</thead>
<tbody>
<tr>
<td>5TUBEOTA_IN_BANDGAP</td>
<td>用在带隙基准里面的运放</td>
</tr>
<tr>
<td>5TUBEOTA_IN_BANDGAP_TESTBENCH</td>
<td>对应的tb</td>
</tr>
<tr>
<td>BANDGAP_VOLTAGE_TESTBENCH</td>
<td>对应的tb</td>
</tr>
<tr>
<td>BANDGAP_VOLTAGE</td>
<td>带隙基准</td>
</tr>
<tr>
<td>OPA5_TUBE_CS</td>
<td>理想电流源的二级运放</td>
</tr>
<tr>
<td>OPA_5TUBE_CS_TESTBENCH</td>
<td>对应的tb</td>
</tr>
<tr>
<td>OTA_5</td>
<td>一级五管运放</td>
</tr>
<tr>
<td>OTA_5_TESTBENCH</td>
<td>一级五管运放对应的tb</td>
</tr>
<tr>
<td>TECH_EVAL</td>
<td>工艺仿真</td>
</tr>
<tr>
<td>TESH_CMRR</td>
<td>共模抑制比仿真</td>
</tr>
<tr>
<td>TESH_INP_OFFSET</td>
<td>输入失调电压</td>
</tr>
<tr>
<td>TESH_PSRR</td>
<td>电源抑制比</td>
</tr>
</tbody>
</table>
<p>1.4375k欧姆</p>
<p><strong>loop loop hhh</strong></p>
<h3 id="after-learning-the-method-of-gmid">After learning the method of gm/Id </h3>
<p>做一个cascode的差分输入的放大器原来没有我想象的那么简单，对于提供一个电流源就是已经很复杂的一件事情了。<br>
然后学完这个gm over id的这个方法之后，感受到的就是为什么没有早一点学习到这个方法😭。<br>
不过下定论为时尚早，所以还看后面的努力啦。还有就是要好好地继续记录，因为前面好像几乎没什实质性地进展，所以前面干了些什么也没有实时性地记录下来，现在也只能凭着记忆来对之前干的事情进行一个简短的记录。<br>
day1和day2在前面已经有很好地记录了，其中有些做了的事情实质上是浪费了很多时间且没有什么作用。比如进行ppt上面所描述的工艺评估，还有就是对一级放大器进行的一系列的测试和数据记录，结果使用了错误的方法（对差分对测量增益相位和频率的图）从而造成了测量的一系列也是错误的。不过写这些只是总结，并不是为了抱怨和推卸责任，毕竟要向前看啦😊。<br>
所以day3和day4还有day5，我们主要也就是做了一些电路的设计，调试电路，这些方面的过程，我们做了很多，譬如思考如何设计一个合适的电流，还有跑工艺角之类的，不过最终还是吃了“儿童套餐”（也就是所谓的通过跑stb仿真，将输出端口和输入端口进行短接来实现输出的共模电平输出的稳定点，以此来轻松地通过了仿真）。<br>
之后在day6，也就是现在我正在写这些东西的时候的昨天，上午半天考了Anlog IC的考试，下午和晚上去画了版图，版图大概画的差不多了，然后第二天的早上，也就是今天的早上，我的队友们花了一点的时间就画完了剩下的所有的版图，原谅我此时还在床上睡懒觉😁，之后他们花了大量的时间进行了drc，然后花了一点点时间进行了lvs，至于关于在其中他们的感想，就需要他们来记录了。<br>
然后我今天主要学习了gm over id这个方法，上面已经具体提到过了，然后学习到对电路设计的另一条思路。我粗略地陈述一下两种设计思路。</p>
<ol>
<li>
<p>第一种（课程ppt上面提供的方法）：<br>
这个方法是PM出发，通过PM来计算（由于第一个极点可以完全提供90度，零点即使远离了GX的10倍频5.7度的相位贡献，所以计算出第二个极点应该是GX的多少倍才能保证PM，而这个多少倍就是一个用来确定Cc的值tan24.3）应需要的Cc使用了经验公式CC = p2overGX/10*CL，而这个p2overGX是通过PM来计算出来的，下面是我通过使用matlab进行的计算展示。</p>
<pre data-role="codeBlock" data-info="matlab" class="language-matlab matlab"><code><span class="token comment">% 输入数据(注意角度和弧度的转换)</span>
PM <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
GX <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">% 单位M</span>
CL <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">% 单位p</span>
pole1P <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
zeroP <span class="token operator">=</span> <span class="token function">atan</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">360</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword keyword-pi">pi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">% 计算</span>
pole2P <span class="token operator">=</span> <span class="token number">180</span><span class="token operator">-</span><span class="token number">90</span><span class="token operator">-</span>PM<span class="token operator">-</span>zeroP<span class="token punctuation">;</span>
p2overGX <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token function">tan</span><span class="token punctuation">(</span>pole2P<span class="token operator">*</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword keyword-pi">pi</span><span class="token operator">/</span><span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pole2 <span class="token operator">=</span> GX<span class="token operator">*</span>p2overGX<span class="token punctuation">;</span>
Cc <span class="token operator">=</span> p2overGX<span class="token operator">/</span><span class="token number">10</span><span class="token operator">*</span>CL<span class="token punctuation">;</span>
</code></pre><p>输出结果如下:</p>
<blockquote>
<p>p2overGX = 2.2158<br>
pole2 = 44.316 MHz<br>
Cc = 4.4317 pF</p>
</blockquote>
<p>得到Cc之后，便可以通过计算以下公式计算所需要得到的gm，通过gm得到电流id，这种方法中从gm得到id大概是使用了对管子的Vov进行了假设，使用gm=2Id/Vov这个公式，之后从电流得到宽长比，但是并不能得到一个确切的W和L，只能得到一个比值，这是我在设计中为什么计算出来的值不满足的一个原因之一，另一个原因就是在计算中的使用的一些参数（比如kn/kp/lumbda）都是在估算出来的，而其中的lumbda这个显然是随着沟道长度变化而变化的。下面的第二种方法则很好地解决了这个问题。</p>
</li>
<li>
<p>第二种方法：<br>
gmid，通过gm/id来构建一个新的参数，对这个新的参数的intrinsic gain和current density进行仿真，按沟道长度扫描，后面将利用得到这些数据图像。这种设计方法与上一种相同的是同样根据带宽来确定gm，其中确定Cc直接使用经验值0.2~0.3倍的CL来确定，也是得到Cc之后通过带宽限制来求得第一级运放的跨导gm1，而对第二级如何来求，这个老师使用了这样一个经验公式，在下面图片中显示。<img src="image-1.png" alt="如何求gm2">但实际上这个数据和第一种方法是可以互相印证的，因为方法一计算所得的p2overGX是2.2158左右，Cc值也也就是0.22158倍，与本方法相对应的Cc取0.2~0.3倍是符合的，而本方法中的p2overGX经验公式取值是2.5~3倍这个范围中。方法一和方法二求gm的方法可以认为是一样的，其中像上图中所写的求gm2的时候对CL乘了1.3是考率到输出节点的寄生电容人为大概是负载的0.3倍。我再列出下列公式来讨论每个设计参数对于哪个方向来进行放缩可以达到留出更多的余度。</p>
<ul>
<li>p2overGX = pole2/GX = 1/tan(pole2P) ： 这个值在计算值上放大就意味着将第二极点远离带宽，可以拥有更好的PM，但不能放的太大，原因还没想好（笑），可能是去为留下更多的PM而去放大p2overGX已经没有太大的作用了（类似log函数中当x较小时增大x可以使得x急剧增大，但当x较大之后，增大为原来的两倍，y也几乎没有增大多少），这个后面有空再研究吧。</li>
<li>gm1 = GX*Cc ：当带宽不够的时候去增大gm1可以是带宽满足要求，但是这样做由于带宽变大了，需要同时去增大gm2去满足足够好的PM，所以在调电路的时候应该首先去满足带宽，再去满足PM，因为如果先满足好了PM，但由于带宽不够去调整带宽之后，会使得重新调整PM。</li>
</ul>
<p>在上面确定了gm1和gm2之后，方法二与前面方法不同的且非常有用的就是通过gm来求Id，得到W和L的方法更准确。通过扫描得到两幅图像。取一个合适gm/id的值，通过增益曲线可以得到沟道长度取多少的时候达到合适的增益，在对gm/id来进行取值的同时也就可以得到电流的值，知道了id又拥有电流密度的图，并且沟道长度已经确定，就可以确定对应沟道长度曲线横坐标为所选gm/id的值对应的电流密度，从而求得W的值，至此一个晶体管的参数便全部设计完成。而multipler是一个需要注意的点，不同的multipler对应着不同的效果，所以对于不同multipler可以进行多个不同的工艺评估。<br>
从这种方法中还学到的是，对于电流源为了减小噪声需要较小的gmoverid，而对于信号输入管，减小噪声则需要更大的gmoverid。<br>
最后附上老师总结的是应该方法进行设计的步骤。<img src="image.png" alt="steps in gmid design"><br>
至此，对于这些方法的学习的总结就全部写完了，后面要做的就是使用gm/id方法来进行设计的过程中的记录。<br>
因为从这个视频收益，所以将链接贴在了下面，感谢这个老师和转载者。<br>
【The gmid methodology】 <a href="https://www.bilibili.com/video/BV1PZ4y1g7cZ/?p=9&amp;share_source=copy_web&amp;vd_source=aa4641ffa1428b9b417d1c648edda95b">https://www.bilibili.com/video/BV1PZ4y1g7cZ/?p=9&amp;share_source=copy_web&amp;vd_source=aa4641ffa1428b9b417d1c648edda95b</a></p>
</li>
</ol>
<h3 id="设计记录">设计记录 </h3>
<h4 id="使用gmid的方法进行工艺评估">使用gm/id的方法进行工艺评估 </h4>
<ol>
<li>由于使用厚栅工艺，并且使用的是3.3v的电源电压，一般定义Vds为Vdd的一半，也就是1.65V。</li>
<li>工艺限制沟道长最长为20u，所以扫描20个沟道长度，从1u到20u。</li>
<li>对栅极电压的扫描是VTH小一点到Vds+VTH（管子进入线性区）多一点，也就是Vgs nmos 0.7~2.35V, pmos 0.8~2.45，多一点就是nmos 0.65~2.4V, pmos 0.75~2.5V（0.8~2.55V）。</li>
<li>mul定位想定的但是在后面的设计中，就要使用相同的mul。</li>
<li>W定位10u，这个不影响测量，可以对不同W来仿真进行验证。</li>
</ol>
<p>开始仿真，得到相应图形，这里暂时就暂时不放相关图形了。</p>
<h4 id="设计电路">设计电路 </h4>
<p>在设计中，暂时考虑将零点移动到无穷远处，即让R=1/gm2。<br>
前面的方法已经陈述了设计思路，这里就不再赘述，便尽快一笔带过。通过下列matlab代码来代替讲述。<br>
<img src="image-2.png" alt="matlab code"><br>
数据计算结果如下:分别计算了两种方法的数值<br>
<img src="image-3.png" alt="result"><br>
由于方法2更加地精准，后续的计算均按照方法二进行计算。<br>
由于考虑到衬底耦合，从书上677页摘抄如下</p>
<blockquote>
<p>同样在运放电路中最好采用PMOS差动输入，这是因为PMOS差动对所在的阱可以接到它们的共源端，减小了衬底噪声的影响。</p>
</blockquote>
<p>所以考虑使用PMOS做为第一级的差动输入管，可以减小噪声，提高CMRR。</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>